<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BreadHub - Set Main Categories</title>
    <style>
        body { font-family: system-ui, sans-serif; max-width: 1000px; margin: 0 auto; padding: 20px; background: #1a1a2e; color: #eee; }
        h1 { color: #f39c12; }
        .status { padding: 15px; margin: 10px 0; border-radius: 5px; }
        .info { background: #3498db; }
        .success { background: #27ae60; }
        button { background: #f39c12; color: #000; border: none; padding: 15px 30px; font-size: 16px; cursor: pointer; border-radius: 5px; margin: 10px 5px; }
        button:hover { background: #e67e22; }
        #log { background: #0a0a15; padding: 15px; border-radius: 5px; max-height: 400px; overflow-y: auto; font-family: monospace; font-size: 12px; margin-top: 20px; }
        .log-success { color: #2ecc71; }
        .log-error { color: #e74c3c; }
        .log-info { color: #3498db; }
        .stats { display: flex; gap: 20px; margin: 20px 0; }
        .stat-box { background: #0a0a15; padding: 20px; border-radius: 8px; text-align: center; flex: 1; }
        .stat-value { font-size: 2rem; font-weight: bold; color: #f39c12; }
        .stat-label { color: #888; }
    </style>
</head>
<body>
    <h1>üçû Set Main Categories for Products</h1>
    
    <div class="status info">
        This tool will set <strong>mainCategory</strong> field for all products:<br>
        ‚Ä¢ Coffee, Non-Coffee ‚Üí <strong>"Drinks"</strong><br>
        ‚Ä¢ Everything else ‚Üí <strong>"Breads"</strong>
    </div>
    
    <div class="stats">
        <div class="stat-box">
            <div class="stat-value" id="totalCount">-</div>
            <div class="stat-label">Total Products</div>
        </div>
        <div class="stat-box">
            <div class="stat-value" id="breadsCount">-</div>
            <div class="stat-label">üçû Breads</div>
        </div>
        <div class="stat-box">
            <div class="stat-value" id="drinksCount">-</div>
            <div class="stat-label">ü•§ Drinks</div>
        </div>
    </div>
    
    <button onclick="checkProducts()">üîç Check Products</button>
    <button onclick="updateProducts()">‚úÖ Update All Products</button>
    
    <div id="log"></div>

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <script>
        firebase.initializeApp({
            apiKey: "AIzaSyAj2szYv9ynVFrxdH0tpUsOg7JmJn6Wq0g",
            authDomain: "breadhub-proofmaster.firebaseapp.com",
            projectId: "breadhub-proofmaster",
            storageBucket: "breadhub-proofmaster.firebasestorage.app",
            messagingSenderId: "222137689770",
            appId: "1:222137689770:web:645c552afa835732c852d3"
        });
        const db = firebase.firestore();
        
        // Drink categories
        const drinkCategories = ['coffee', 'non-coffee', 'drinks', 'beverages'];
        
        function isDrinkCategory(category) {
            if (!category) return false;
            const cat = category.toLowerCase();
            return drinkCategories.some(d => cat.includes(d));
        }
        
        function log(msg, type = 'info') {
            const logDiv = document.getElementById('log');
            const entry = document.createElement('div');
            entry.className = `log-${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        async function checkProducts() {
            log('Checking products...', 'info');
            
            const snapshot = await db.collection('products').get();
            const products = snapshot.docs.map(d => ({ id: d.id, ...d.data() }));
            
            let breads = 0, drinks = 0;
            
            products.forEach(p => {
                const isDrink = isDrinkCategory(p.category);
                if (isDrink) {
                    drinks++;
                    log(`ü•§ ${p.name} (${p.category}) ‚Üí Drinks`, 'info');
                } else {
                    breads++;
                    log(`üçû ${p.name} (${p.category}) ‚Üí Breads`, 'info');
                }
            });
            
            document.getElementById('totalCount').textContent = products.length;
            document.getElementById('breadsCount').textContent = breads;
            document.getElementById('drinksCount').textContent = drinks;
            
            log(`Total: ${products.length} | Breads: ${breads} | Drinks: ${drinks}`, 'success');
        }
        
        async function updateProducts() {
            if (!confirm('Update mainCategory for all products?')) return;
            
            log('Updating products...', 'info');
            
            const snapshot = await db.collection('products').get();
            let updated = 0, errors = 0;
            
            for (const doc of snapshot.docs) {
                const data = doc.data();
                const isDrink = isDrinkCategory(data.category);
                const mainCategory = isDrink ? 'Drinks' : 'Breads';
                
                try {
                    await db.collection('products').doc(doc.id).update({
                        mainCategory: mainCategory
                    });
                    log(`‚úì ${data.name} ‚Üí ${mainCategory}`, 'success');
                    updated++;
                } catch (error) {
                    log(`‚úó ${data.name}: ${error.message}`, 'error');
                    errors++;
                }
            }
            
            log(`Done! Updated: ${updated}, Errors: ${errors}`, 'success');
            log('Refresh POS to see the changes!', 'info');
        }
    </script>
</body>
</html>
