# BreadHub POS - Handoff Document
**Date:** December 24, 2025
**Session End:** 2:30 AM

---

## üóÇÔ∏è PROJECT LOCATION
```
/Volumes/Wotg Drive Mike/GitHub/Breadhub-website/
```

**Live URL:** https://breadhub.shop/pos/

**GitHub:** https://github.com/PinedaMikeB/breadhub-website

---

## ‚úÖ WHAT WAS ACCOMPLISHED THIS SESSION

### 1. PIN-Based Login System
- Replaced email/password login with 4-6 digit PIN codes
- Numeric keypad for touchscreen input
- Staff data stored in Firebase `staff` collection
- Removed Staff Setup and Admin Login links from login screen (security)

### 2. Staff Management Page
- Created `/pos/staff-setup.html` for managing staff
- Fields: Name, PIN, Role, Day Off, Monthly Salary, Transport Allowance (per day)
- Permissions: Can Use POS, Give Discounts, Void Sales, View Reports
- Access restricted to Owner/Manager only

### 3. Shift Management System
- Owners/Managers get choice: "Start Shift" or "View Only" mode
- Cashiers must start a shift to use POS
- Shift tracks: starting cash, sales by payment method, transactions
- Sales linked to shifts via `shiftId` field

### 4. Enhanced End Shift with Emergency Stock Purchases
- Separates Cash vs GCash sales
- Expected cash = Starting Cash + Cash Sales only
- Emergency stock purchases with searchable dropdowns for:
  - Items (from `ingredients` and `packagingMaterials` collections)
  - Suppliers (from `suppliers` collection)
- Calculates variance: BALANCED / SHORT / OVER
- Generates shift report with Print & Email options

---

## üî¥ ISSUES TO FIX IN NEXT SESSION

### 1. Supplier Dropdown Not Working
The supplier search dropdown in End Shift ‚Üí Emergency Stock Purchases is not functioning correctly. Need to debug `Auth.filterSuppliers()` and `Auth.showSupplierDropdown()` functions in `/pos/js/auth.js`.

### 2. Immediate Stock Update (IMPORTANT WORKFLOW CHANGE)
**Current behavior:** Emergency purchases create `pendingPurchases` records that need approval in ProofMaster before stock updates.

**Required behavior:** When cashier selects an actual item from the dropdown and enters quantity:
- Stock should be **immediately updated** in the ingredient/packaging record
- NO need for purchase request ‚Üí approval ‚Üí PO ‚Üí received workflow
- The item is already bought and being used by bakers

**Why this matters:** Production in ProofMaster won't run until ingredients are in stock. Bakers need the stock updated immediately so they can start production.

### 3. Draft/Save Emergency Purchases Without Ending Shift
**Current behavior:** Emergency purchases are only saved when shift ends.

**Required behavior:** 
- Add a **"Save Purchases"** button that:
  - Saves the emergency purchase entries
  - **Immediately updates stock** in `ingredients` or `packagingMaterials`
  - Does NOT end the shift
- Cashier can continue working after saving purchases
- This allows bakers to start production while cashier continues selling

---

## üìÅ KEY FILES

| File | Purpose |
|------|---------|
| `/pos/js/auth.js` (v7) | PIN login, shift management, end shift with expenses |
| `/pos/js/admin.js` (v3) | Admin panel, shift display |
| `/pos/js/pos.js` (v4) | POS main, sales linked to shifts |
| `/pos/staff-setup.html` | Staff management (owner/manager only) |
| `/pos/css/pos-styles.css` (v11) | All POS styling |
| `/pos/index.html` | Main POS with PIN keypad |

---

## üîß FIREBASE COLLECTIONS

### `staff` Collection
```javascript
{
  name: "Maria Santos",
  pin: "1234",
  role: "cashier", // owner, manager, cashier, baker
  dayOff: "Sunday",
  monthlySalary: 12000,
  dailyRate: 461.54, // auto-calculated
  transportAllowance: 100, // per day
  canUsePOS: true,
  canGiveDiscount: false,
  canVoidSales: false,
  canViewReports: true,
  status: "active",
  createdAt: "..."
}
```

### `shifts` Collection
```javascript
{
  staffId: "xxx",
  staffName: "Maria Santos",
  staffRole: "cashier",
  dateKey: "2025-12-24",
  shiftNumber: 1,
  startTime: "...",
  endTime: "...",
  startingCash: 1000,
  cashSales: 1500,
  gcashSales: 500,
  totalSales: 2000,
  transactionCount: 15,
  expectedCash: 2500,
  expenses: 200,
  expensesDetails: [...],
  adjustedExpected: 2300,
  actualCash: 2300,
  variance: 0,
  balanceStatus: "balanced",
  status: "completed"
}
```

### `pendingPurchases` Collection (may need to change approach)
```javascript
{
  shiftId: "xxx",
  shiftNumber: 1,
  dateKey: "2025-12-24",
  cashierName: "Nam",
  itemId: "ingredient_abc",
  itemName: "Eggs",
  itemType: "ingredient", // or "packaging"
  supplierId: "supplier_xyz",
  supplierName: "Puregold",
  qty: 2,
  unit: "tray",
  amount: 440,
  status: "pending",
  createdAt: "..."
}
```

---

## üéØ RECOMMENDED IMPLEMENTATION FOR NEXT SESSION

### For Immediate Stock Update:

```javascript
// In Auth.js - when saving emergency purchase
async saveEmergencyPurchase(purchase) {
  const collection = purchase.itemType === 'ingredient' 
    ? 'ingredients' 
    : 'packagingMaterials';
  
  // Get current stock
  const item = await DB.get(collection, purchase.itemId);
  const currentStock = item.currentStock || 0;
  
  // Update stock immediately
  await DB.update(collection, purchase.itemId, {
    currentStock: currentStock + purchase.qty,
    lastRestocked: new Date().toISOString(),
    lastRestockedBy: this.userData.name,
    lastRestockSource: 'emergency-purchase'
  });
  
  // Log the purchase for records
  await DB.add('stockMovements', {
    itemId: purchase.itemId,
    itemName: purchase.itemName,
    itemType: purchase.itemType,
    movementType: 'emergency-restock',
    quantity: purchase.qty,
    unit: purchase.unit,
    amount: purchase.amount,
    supplier: purchase.supplierName,
    shiftId: this.currentShift.id,
    addedBy: this.userData.name,
    timestamp: new Date().toISOString()
  });
}
```

### For Draft/Save Button:

Add a "üíæ Save & Update Stock" button in the expenses section that:
1. Validates all expense entries have item, qty, and amount
2. Calls `saveEmergencyPurchase()` for each entry
3. Shows success toast: "Stock updated! Bakers can now start production."
4. Clears the saved entries from the form
5. Does NOT close the End Shift modal

---

## üìã QUICK REFERENCE

### Cache Busters (update these when making changes):
- auth.js ‚Üí v7
- admin.js ‚Üí v3
- pos.js ‚Üí v4
- pos-styles.css ‚Üí v11

### To Deploy:
```bash
cd /Volumes/Wotg Drive Mike/GitHub/Breadhub-website
git add .
git commit -m "your message"
git push
```
Then click **Deploy** in Hostinger Git panel.

---

## üë• STAFF ROLES

| Role | POS Access | Admin | Staff Setup | Shift Required |
|------|------------|-------|-------------|----------------|
| Owner | ‚úÖ | ‚úÖ | ‚úÖ | Optional (View Only mode) |
| Manager | ‚úÖ | ‚úÖ | ‚úÖ | Optional (View Only mode) |
| Cashier | ‚úÖ | ‚ùå | ‚ùå | Required |
| Baker | ‚ùå | ‚ùå | ‚ùå | N/A |

---

**Previous Transcript:** `/mnt/transcripts/2025-12-23-18-13-57-pos-reports-chart-fixes-shift-system-planning.txt`
