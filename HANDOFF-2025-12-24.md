# BreadHub POS - Handoff Document
**Date:** December 24, 2025
**Session End:** 11:00 AM

---

## ğŸ—‚ï¸ PROJECT LOCATION
```
/Volumes/Wotg Drive Mike/GitHub/Breadhub-website/
```

**Live URL:** https://breadhub.shop/pos/

**GitHub:** https://github.com/PinedaMikeB/breadhub-website

---

## âœ… WHAT WAS ACCOMPLISHED THIS SESSION

### 1. Change Fund System (CRITICAL BUSINESS RULE)
**The change fund is NON-NEGOTIABLE:**
- Fixed amount set by Owner/Manager (default â‚±1,000)
- Can ONLY be increased (via bank withdrawal, owner capital)
- Can NEVER be decreased
- Must be handed over exactly between shifts
- Forces reflection of SHORT/OVER if any discrepancy

### 2. Strict Shift Start Requirements
- Starting cash is **REQUIRED** (not optional)
- Cashiers CANNOT bypass the Start Shift modal
- Cashiers CANNOT cancel - must enter starting cash
- Only Owner/Manager can cancel/skip
- Starting cash must match or exceed change fund

### 3. Cash Handover Verification
- Outgoing cashier declares total cash including change fund
- System warns if cash is below change fund (CRITICAL)
- Incoming cashier verifies received amount
- All discrepancies logged and emailed

### 4. Change Fund Management
- Owner/Manager can access via `Auth.showChangeFundSettings()`
- Can only INCREASE, never decrease
- Logs source (bank withdrawal, owner capital, etc.)
- All changes tracked in `changeFundHistory` collection

---

## ğŸ’° CHANGE FUND BUSINESS RULES

```
RULE 1: Change fund is FIXED
- Set once by owner/manager
- Example: â‚±1,000 or â‚±2,000

RULE 2: Can only INCREASE
- Source: Bank withdrawal, owner capital
- Logged with timestamp and reason
- NEVER allowed to decrease

RULE 3: Must be handed over intact
- Outgoing cashier hands over: Change Fund + Net Sales
- If cash < Change Fund = CRITICAL ERROR
- Variance only comes from sales portion

RULE 4: Starting cash REQUIRED
- Cashier must count drawer before starting
- Must be >= Change Fund
- Cannot skip or bypass
```

---

## ğŸ”„ UPDATED CASH HANDOVER FLOW

```
DRAWER CALCULATION:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Change Fund (Fixed):     â‚±1,000
+ Cash Sales:            â‚±5,000
- Cash Expenses:         â‚±  500
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Expected in Drawer:      â‚±5,500

HANDOVER:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Outgoing counts:         â‚±5,400  â† SHORT â‚±100
Change Fund portion:     â‚±1,000  â† Must be intact!
Sales portion:           â‚±4,400  â† This is where shortage is

INCOMING VERIFICATION:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Declared by outgoing:    â‚±5,400
Incoming counts:         â‚±5,400  â† Matches
Starting cash recorded:  â‚±5,400
```

---

## ğŸ“ FILES MODIFIED THIS SESSION

| File | Version | Changes |
|------|---------|---------|
| `/pos/js/auth.js` | v7 â†’ v10 | Change fund rules, strict shift start, handover verification |
| `/pos/js/modal.js` | v1 â†’ v2 | Custom footer support |
| `/pos/css/pos-styles.css` | v11 â†’ v14 | New UI styles |
| `/pos/index.html` | - | Updated cache busters |

---

## ğŸ”§ NEW DATABASE COLLECTIONS/FIELDS

### `settings` Collection (document id: 'pos')
```javascript
{
  changeFund: 1000,
  changeFundUpdatedAt: '2025-12-24T10:00:00Z',
  changeFundUpdatedBy: 'Mike'
}
```

### `changeFundHistory` Collection
```javascript
{
  previousAmount: 1000,
  newAmount: 1500,
  increase: 500,
  source: 'bank',  // 'bank', 'owner', 'other'
  notes: 'Added from BDO withdrawal',
  updatedBy: 'Mike',
  timestamp: '2025-12-24T10:00:00Z'
}
```

### `handoverDiscrepancies` Collection
```javascript
{
  type: 'incoming' | 'outgoing',
  shiftId: 'shift_abc',
  shiftNumber: 1,
  dateKey: '2025-12-24',
  outgoingCashier: 'Maria',
  incomingCashier: 'Juan',
  expected: 5500,
  actual: 5400,
  variance: -100,  // negative = short
  changeFundIntact: true,  // Was change fund portion ok?
  timestamp: '2025-12-24T10:30:00Z'
}
```

---

## ğŸ”´ REMAINING ISSUES TO FIX

1. **Supplier Dropdown** - Debug emergency purchases form
2. **Immediate Stock Update** - Update stock directly when expense saved
3. **Add-Ons Category** - Check products, add filter in POS & website
4. **Operations Manager App** - Push notifications for discrepancies

---

## ğŸ“‹ QUICK REFERENCE

### Cache Busters:
- auth.js â†’ v10
- modal.js â†’ v2
- pos-styles.css â†’ v14

### To Deploy:
```bash
cd /Volumes/Wotg Drive Mike/GitHub/Breadhub-website
git add .
git commit -m "Add strict change fund rules and handover verification"
git push
```

### To Set Initial Change Fund:
In Firebase Console, create document `settings/pos`:
```json
{
  "changeFund": 1000
}
```

Or use Admin access to call `Auth.showChangeFundSettings()`

---

## ğŸ¯ NEXT STEPS

1. **Deploy & Test** - Verify change fund and handover flows
2. **Set Initial Change Fund** - Create settings document in Firebase
3. **Add-Ons Category** - Implement filter for POS and website
4. **Fix Supplier Dropdown** - Debug emergency purchases
